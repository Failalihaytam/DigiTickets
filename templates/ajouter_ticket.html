<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Ajouter un ticket - DigiTickets</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            text-align: center;
        }
        .popup.show {
            display: block;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .overlay.show {
            display: block;
        }
        .popup-content {
            margin-bottom: 20px;
        }
        .popup-btn {
            background: #7A9B41;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }
        .popup-btn:hover {
            background: #5e7c2c;
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="{{ url_for('static', filename='Logotype@2x.png') }}" alt="CDG Logo" class="logo-img">
        <div class="app-name">DigiTickets</div>
    </div>
    <div class="card">
        <h2>Ajouter un ticket</h2>
        <form method="post" enctype="multipart/form-data">
            <label for="titre">Ticket :</label>
            <input type="text" id="titre" name="titre" required placeholder="Titre du ticket"><br>
            <label for="description">Description :</label>
            <textarea id="description" name="description" rows="4" placeholder="Décrivez votre problème ou demande"></textarea><br>
            <label for="categorie">Catégorie :</label>
            <select id="categorie" name="categorie" required>
                <option value="">Sélectionner une catégorie</option>
                {% for cat in categories %}
                    <option value="{{ cat[0] }}">{{ cat[1] }}</option>
                {% endfor %}
            </select><br>
            <label for="type">Type :</label>
            <select id="type" name="type" required>
                <option value="">Sélectionner un type</option>
                {% for t in types %}
                    <option value="{{ t[0] }}">{{ t[1] }}</option>
                {% endfor %}
            </select><br>
            <label for="fichier">Joindre un fichier (optionnel) :</label>
            <input type="file" id="fichier" name="fichier" accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx,.txt"><br>
            <button type="submit">Créer le ticket</button>
        </form>
        <a href="{% if session.get('user_role') == 'N2' %}{{ url_for('dashboard_admin') }}{% else %}{{ url_for('dashboard_initial') }}{% endif %}" class="back-link">Retour au tableau de bord</a>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="popup" id="successPopup">
        <div class="popup-content">
            <h3 style="color: #7A9B41; margin-bottom: 15px;">Succès!</h3>
            <p>Votre ticket a été créé avec succès.</p>
        </div>
        <button class="popup-btn" onclick="redirectToDashboard()">OK</button>
    </div>

    <script>
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch(window.location.href, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    showPopup();
                } else {
                    throw new Error('Erreur lors de la création du ticket');
                }
            })
            .catch(error => {
                alert('Une erreur est survenue: ' + error.message);
            });
        });

        function showPopup() {
            document.getElementById('overlay').classList.add('show');
            document.getElementById('successPopup').classList.add('show');
        }

        function redirectToDashboard() {
            window.location.href = "{% if session.get('user_role') in ['N1', 'N2', 'N3', 'N4'] %}{{ url_for('dashboard_admin') }}{% else %}{{ url_for('dashboard_initial') }}{% endif %}";
        }
    </script>
</body>
</html> 