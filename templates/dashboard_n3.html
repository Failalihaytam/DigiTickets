<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau de bord N3 - DigiTickets</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body { margin:0; padding:0; display:flex; min-height:100vh; }
        .sidebar { width:250px; background:#f4f7f2; padding:24px 18px; box-shadow:2px 0 8px rgba(55,63,65,0.1); display:flex; flex-direction:column; gap:18px; position:fixed; left:0; top:0; height:100vh; overflow-y:auto; }
        .sidebar a { color:#373F41; text-decoration:none; font-weight:500; font-size:1.05rem; padding:12px 16px; border-radius:8px; transition:background .2s, color .2s; }
        .sidebar a:hover { background:#e6f2d8; color:#7A9B41; }
        .main-content { flex:1; margin-left:250px; padding:24px; background:#f8f9fa; min-height:100vh; }
        .logo-container { margin-bottom:32px; }
        @media (max-width:900px){ body{flex-direction:column;} .sidebar{position:relative;width:100%;height:auto;flex-direction:row;padding:12px 24px;gap:12px;justify-content:center; box-shadow:0 2px 8px rgba(55,63,65,.1);} .main-content{margin-left:0;padding:16px;} }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo-container">
            <img src="{{ url_for('static', filename='Logotype@2x.png') }}" alt="CDG Logo" class="logo-img">
            <div class="app-name">DigiTickets</div>
        </div>
        <a href="{{ url_for('resoudre_tickets') }}">Résoudre tickets</a>
        <a href="{{ url_for('logout') }}">Se déconnecter</a>
    </div>
    <div class="main-content">
        <div class="card">
            <h2>Bonjour N3 {{ nom }} !</h2>
            <div style="text-align:center; margin-bottom:24px;">
                <a href="{{ url_for('ajouter_ticket') }}" class="dashboard-btn">Ajouter un ticket</a>
            </div>
            <div class="tickets-section">
                <h3>Mes tickets</h3>
                {% if tickets %}
                    <div class="tickets-list">
                        {% for ticket in tickets %}
                            <div class="ticket-item">
                                <div class="ticket-header">
                                    <h4>{{ ticket[1] }}</h4>
                                    <span class="ticket-date">{{ ticket[3][:10] if ticket[3] else 'N/A' }}</span>
                                </div>
                                <p class="ticket-description">{{ ticket[2][:100] + '...' if ticket[2] and ticket[2]|length > 100 else ticket[2] or 'Aucune description' }}</p>
                                <div class="ticket-status">
                                    <span class="status-badge">{{ ticket[4] or 'Statut inconnu' }}</span>
                                </div>
                                {% if ticket[4] == 'Incident résolu' %}
                                    <div style="display:flex; gap:8px; margin-top:8px;">
                                        <form method="POST" action="{{ url_for('valider_ticket', ticket_id=ticket[0]) }}">
                                            <button type="submit" class="dashboard-btn">Valider (OK)</button>
                                        </form>
                                        <form method="POST" action="{{ url_for('refuser_ticket', ticket_id=ticket[0]) }}">
                                            <button type="submit" class="dashboard-btn" style="background:#dc3545;">Refuser (KO)</button>
                                        </form>
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="no-tickets">Aucun ticket créé pour le moment.</p>
                {% endif %}
            </div>
        </div>
    </div>
</body>
{% include '_chatbot_widget.html' %}
</html> 